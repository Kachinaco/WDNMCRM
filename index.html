<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows & Doors CRM - Professional Contractor Management</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <style>
        :root {
            /* Monday.com exact colors */
            --monday-primary: #0073ea;
            --monday-primary-dark: #0060c0;
            --monday-primary-light: #0085ff;
            --monday-success: #00c875;
            --monday-success-dark: #00a862;
            --monday-warning: #ffcb00;
            --monday-warning-dark: #fdab3d;
            --monday-danger: #d83a52;
            --monday-danger-dark: #bb3545;
            --monday-purple: #a25ddc;
            --monday-purple-dark: #8b4dc0;
            --monday-dark: #323338;
            --monday-gray: #676879;
            --monday-light-gray: #c5c7d0;
            --monday-light: #f5f6f8;
            --monday-border: #e6e9ef;
            --monday-hover-bg: rgba(0, 115, 234, 0.04);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.16);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --gray: #6b7280;
            --light: #f3f4f6;
            --white: #ffffff;
            --border: #e5e7eb;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            background: var(--white);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            min-height: 600px;
        }
        
        .auth-sidebar {
            flex: 1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: var(--white);
        }
        
        .auth-sidebar h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .auth-sidebar p {
            font-size: 1.1rem;
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .features {
            list-style: none;
        }
        
        .features li {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        .features li::before {
            content: '✓';
            display: inline-block;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 12px;
        }
        
        .auth-main {
            flex: 1;
            padding: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .auth-header {
            margin-bottom: 40px;
        }
        
        .auth-header h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .auth-header p {
            color: var(--gray);
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: var(--light);
            border: 2px solid var(--light);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: var(--white);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }
        
        .btn-block {
            width: 100%;
        }
        
        .divider {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }
        
        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border);
        }
        
        .divider span {
            background: var(--white);
            padding: 0 15px;
            color: var(--gray);
            position: relative;
        }
        
        .demo-btn {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }
        
        .demo-btn:hover {
            background: var(--white);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .app-container {
            display: none;
            min-height: 100vh;
            background: var(--light);
        }
        
        .navbar {
            background: var(--white);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .navbar-menu {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .nav-link {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: var(--primary);
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .dashboard-header {
            margin-bottom: 30px;
        }
        
        .dashboard-header h1 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card h3 {
            color: var(--gray);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .stat-change {
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .stat-change.negative {
            color: var(--danger);
        }
        
        .workflow-section {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .workflow-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .workflow-header h2 {
            font-size: 1.5rem;
            color: var(--dark);
        }
        
        .workflow-stages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .stage-column {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            min-height: 300px;
        }
        
        .stage-header {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
        }
        
        .job-card {
            background: var(--white);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid var(--primary);
        }
        
        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: rgba(37, 99, 235, 0.05);
        }
        
        .job-card h4 {
            font-size: 0.95rem;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .job-card p {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .estimation-tool {
            background: var(--white);
            border-radius: 12px;
            padding: 25px;
        }
        
        .estimation-header {
            margin-bottom: 25px;
        }
        
        .estimation-header h2 {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .product-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .product-card {
            padding: 20px;
            border: 2px solid var(--border);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .product-card:hover,
        .product-card.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }
        
        .product-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .measurement-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .measurement-input {
            display: flex;
            flex-direction: column;
        }
        
        .measurement-input label {
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 6px;
        }
        
        .input-group span {
            color: var(--gray);
            font-weight: 500;
        }
        
        .calculation-results {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .result-row:last-child {
            border-bottom: none;
            padding-top: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--dark);
        }
        
        .modal-close {
            float: right;
            font-size: 1.5rem;
            color: var(--gray);
            cursor: pointer;
            background: none;
            border: none;
        }
        
        /* Customer Profile Styles */
        .customer-profile-modal .modal-content {
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .profile-header {
            padding: 25px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            border-radius: 12px 12px 0 0;
            margin: -30px -30px 20px -30px;
        }
        
        .profile-header h2 {
            margin-bottom: 10px;
        }
        
        .profile-meta {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .profile-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
        }
        
        .profile-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: var(--gray);
            font-weight: 500;
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
        }
        
        .profile-tab.active {
            color: var(--primary);
        }
        
        .profile-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary);
        }
        
        .profile-content {
            flex: 1;
            overflow-y: auto;
            padding: 0 5px;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .detail-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .detail-form .form-group.full-width {
            grid-column: span 2;
        }
        
        .estimates-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .estimate-card {
            background: var(--light);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .estimate-info h4 {
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .estimate-info p {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .estimate-actions {
            display: flex;
            gap: 10px;
        }
        
        .estimate-actions button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .btn-view {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-download {
            background: var(--secondary);
            color: var(--white);
        }
        
        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .file-card {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .file-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .file-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .file-name {
            font-size: 0.85rem;
            color: var(--dark);
            word-break: break-word;
        }
        
        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.02);
        }
        
        .history-timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .history-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border);
        }
        
        .history-item {
            position: relative;
            margin-bottom: 20px;
        }
        
        .history-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 5px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary);
            border: 2px solid var(--white);
        }
        
        .history-time {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .history-content {
            background: var(--light);
            padding: 12px;
            border-radius: 6px;
        }
        
        .notes-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .note-card {
            background: var(--light);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--warning);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .note-content {
            color: var(--dark);
            line-height: 1.5;
        }
        
        .add-note-form {
            display: flex;
            gap: 10px;
        }
        
        .add-note-form textarea {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--border);
            border-radius: 6px;
            resize: vertical;
            min-height: 80px;
        }
        
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
                max-width: 400px;
            }
            
            .auth-sidebar {
                padding: 40px 30px;
            }
            
            .auth-main {
                padding: 40px 30px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .workflow-stages {
                grid-template-columns: 1fr;
            }
        }
        
        /* Monday.com Style Table Board - Enhanced with Scrolling */
        .monday-board {
            background: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 200px);
            max-height: 800px;
        }
        
        .board-table-wrapper {
            flex: 1;
            overflow: auto;
            position: relative;
            background: white;
            border: 1px solid #e6e9ef;
            border-radius: 0 0 8px 8px;
        }
        
        .board-table-wrapper::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        .board-table-wrapper::-webkit-scrollbar-track {
            background: #f0f3f7;
        }
        
        .board-table-wrapper::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 6px;
            border: 2px solid #f0f3f7;
        }
        
        .board-table-wrapper::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }
        
        .board-table-wrapper::-webkit-scrollbar-corner {
            background: #f0f3f7;
        }
        
        .board-header {
            padding: 16px 24px;
            background: linear-gradient(to bottom, #ffffff, #fafbfc);
            border-bottom: 1px solid var(--monday-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        
        .board-title-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .board-title {
            font-size: 24px;
            font-weight: 600;
            color: #323338;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .board-title-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6161ff 0%, #ff6b6b 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .board-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .view-switcher {
            display: flex;
            background: #f0f3f7;
            border-radius: 6px;
            padding: 2px;
        }
        
        .view-btn {
            padding: 6px 12px;
            background: transparent;
            border: none;
            border-radius: 4px;
            color: #676879;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background: white;
            color: #0073ea;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .search-box {
            position: relative;
            margin-right: 12px;
        }
        
        .search-input {
            padding: 8px 12px 8px 36px;
            border: 1px solid #e6e9ef;
            border-radius: 6px;
            width: 200px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #0073ea;
            width: 250px;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #676879;
        }
        
        .board-table {
            width: max-content;
            min-width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 14px;
            background: white;
            table-layout: fixed;
        }
        
        .board-table thead {
            background: #ffffff;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .board-table th {
            padding: 0;
            text-align: left;
            font-weight: 400;
            color: #676879;
            font-size: 14px;
            border-bottom: 1px solid #e6e9ef;
            border-right: 1px solid #f0f3f7;
            background: #ffffff;
            position: relative;
            user-select: none;
            min-width: 50px;
        }
        
        /* Sticky first columns */
        .board-table th:nth-child(1),
        .board-table th:nth-child(2),
        .board-table th:nth-child(3),
        .board-table td:nth-child(1),
        .board-table td:nth-child(2),
        .board-table td:nth-child(3) {
            position: sticky;
            background: white;
            z-index: 50;
        }
        
        .board-table th:nth-child(1),
        .board-table td:nth-child(1) {
            left: 0;
        }
        
        .board-table th:nth-child(2),
        .board-table td:nth-child(2) {
            left: 40px;
        }
        
        .board-table th:nth-child(3),
        .board-table td:nth-child(3) {
            left: 80px;
        }
        
        .board-table thead th:nth-child(1),
        .board-table thead th:nth-child(2),
        .board-table thead th:nth-child(3) {
            z-index: 101;
        }
        
        /* Shadow for sticky columns */
        .board-table td:nth-child(3)::after,
        .board-table th:nth-child(3)::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 0;
            bottom: 0;
            width: 5px;
            background: linear-gradient(to right, rgba(0,0,0,0.1), transparent);
            pointer-events: none;
        }
        
        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .column-header:hover {
            background: #f7f9fb;
        }
        
        .column-header-content {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
        }
        
        .column-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #676879;
        }
        
        .column-name {
            font-size: 13px;
            color: #323338;
            font-weight: 500;
        }
        
        .column-actions {
            display: flex;
            align-items: center;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .column-header:hover .column-actions {
            opacity: 1;
        }
        
        .column-action-btn {
            width: 20px;
            height: 20px;
            background: transparent;
            border: none;
            color: #676879;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .column-action-btn:hover {
            background: #e6e9ef;
            color: #323338;
        }
        
        .add-column-btn {
            width: 40px;
            background: #f7f9fb;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .add-column-btn:hover {
            background: #0073ea;
            color: white;
        }
        
        .add-column-btn::after {
            content: '+';
            font-size: 20px;
            font-weight: 300;
        }
        
        .board-table tbody tr {
            transition: all 0.15s ease;
            position: relative;
            border-left: 3px solid transparent;
        }
        
        .board-table tbody tr:nth-child(even) {
            background: rgba(247, 249, 251, 0.3);
        }
        
        .board-table tbody tr:hover {
            background: linear-gradient(90deg, #f0f7ff 0%, #f7f9fb 100%);
            border-left-color: var(--monday-primary);
            transform: translateX(2px);
        }
        
        .board-table tbody tr.selected {
            background: linear-gradient(90deg, #e8f4ff 0%, #f0f7ff 100%);
            border-left-color: var(--monday-primary);
            box-shadow: inset 0 0 0 1px var(--monday-primary-light);
        }
        
        .board-table tbody tr.selected td {
            position: relative;
        }
        
        .board-table tbody tr.selected td::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            background: rgba(0, 115, 234, 0.03);
            pointer-events: none;
        }
        
        .board-table td {
            padding: 0;
            vertical-align: middle;
            border-bottom: 1px solid #f0f3f7;
            border-right: 1px solid #f0f3f7;
            height: 36px;
            position: relative;
        }
        
        .cell-content {
            padding: 6px 12px;
            min-height: 36px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background 0.1s;
        }
        
        .cell-content:hover {
            background: rgba(0, 115, 234, 0.04);
        }
        
        .cell-content.editing {
            background: white;
            box-shadow: 0 0 0 2px #0073ea;
        }
        
        /* Checkbox column */
        .checkbox-cell {
            min-width: 40px;
            width: 40px;
            text-align: center;
            padding: 0;
            position: relative;
        }
        
        .row-checkbox {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        /* Item ID column */
        .item-id-cell {
            min-width: 80px;
            width: 90px;
            text-align: center;
            color: var(--monday-gray);
            font-size: 12px;
            font-weight: 500;
            background: linear-gradient(to right, #fafbfc, #f5f6f8);
            border-right: 1px solid var(--monday-border);
            position: relative;
        }
        
        .item-id-cell .column-header {
            padding: 8px;
        }
        
        tbody .item-id-cell {
            padding: 8px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            position: relative;
        }
        
        .item-id {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 11px;
            color: var(--monday-gray);
            background: rgba(0, 115, 234, 0.08);
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            transition: all 0.2s;
        }
        
        tbody tr:hover .item-id {
            background: rgba(0, 115, 234, 0.15);
            color: var(--monday-primary);
            transform: scale(1.05);
        }
        
        .item-id:hover {
            background: var(--monday-primary) !important;
            color: white !important;
        }
        
        .item-id.copied {
            animation: copyPulse 0.5s ease;
        }
        
        @keyframes copyPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background: var(--monday-success); }
            100% { transform: scale(1); }
        }
        
        .item-id-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--monday-dark);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        
        .item-id:hover + .item-id-tooltip {
            opacity: 1;
        }
        
        /* Item rows */
        .item-row {
            font-weight: 500;
        }
        
        .subitem-row {
            background: #fafbfc;
        }
        
        .subitem-row td:first-child {
            padding-left: 48px;
        }
        
        /* Expand/Collapse */
        .expand-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            margin-right: 8px;
            color: #676879;
            transition: transform 0.2s;
        }
        
        .expand-btn.expanded {
            transform: rotate(90deg);
        }
        
        .expand-btn:hover {
            color: #323338;
        }
        
        /* Task name cell */
        .task-name {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: #323338;
        }
        
        .task-input {
            border: none;
            background: transparent;
            width: 100%;
            padding: 6px 8px;
            font-size: 14px;
            color: var(--monday-dark);
            font-weight: 500;
            transition: all 0.2s;
            border-radius: 4px;
        }
        
        .task-input:hover {
            background: var(--monday-hover-bg);
        }
        
        .task-input:focus {
            outline: none;
            background: white;
            box-shadow: 0 0 0 2px var(--monday-primary), 0 4px 8px rgba(0,115,234,0.1);
            transform: scale(1.02);
        }
        
        .task-input::placeholder {
            color: var(--monday-light-gray);
            font-weight: 400;
        }
        
        /* Status cells - Enhanced Monday.com style */
        .status-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 5px 16px;
            border-radius: 100px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            min-width: 110px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .status-pill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .status-pill:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .status-pill:hover::before {
            opacity: 1;
        }
        
        .status-pill:active {
            transform: translateY(0) scale(0.98);
        }
        
        .status-working {
            background: linear-gradient(135deg, #fdab3d, #fc9003);
            color: #ffffff;
        }
        
        .status-working::after {
            content: '🔄';
            margin-left: 4px;
            font-size: 12px;
        }
        
        .status-done {
            background: linear-gradient(135deg, #00c875, #00a862);
            color: #ffffff;
        }
        
        .status-done::after {
            content: '✓';
            margin-left: 4px;
            font-weight: bold;
        }
        
        .status-stuck {
            background: linear-gradient(135deg, #e2445c, #d83a52);
            color: #ffffff;
            animation: pulse-danger 2s infinite;
        }
        
        .status-stuck::after {
            content: '⚠';
            margin-left: 4px;
        }
        
        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 0 0 rgba(226, 68, 92, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(226, 68, 92, 0); }
        }
        
        .status-waiting {
            background: linear-gradient(135deg, #0073ea, #0060c0);
            color: #ffffff;
        }
        
        .status-waiting::after {
            content: '⏳';
            margin-left: 4px;
            font-size: 12px;
        }
        
        .status-todo {
            background: linear-gradient(135deg, #c4c4c4, #a8a8a8);
            color: #ffffff;
        }
        
        .status-review {
            background: linear-gradient(135deg, #a25ddc, #8b4dc0);
            color: #ffffff;
        }
        
        .status-review::after {
            content: '👁';
            margin-left: 4px;
            font-size: 12px;
        }
        
        /* Priority cells - Enhanced */
        .priority-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .priority-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.12);
        }
        
        .priority-critical {
            background: linear-gradient(135deg, #401694, #5522aa);
            color: white;
            animation: pulse-critical 1.5s infinite;
        }
        
        .priority-critical::before {
            content: '🔴';
            font-size: 10px;
        }
        
        @keyframes pulse-critical {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .priority-high {
            background: linear-gradient(135deg, #e2445c, #d83a52);
            color: white;
        }
        
        .priority-high::before {
            content: '⚡';
            font-size: 11px;
        }
        
        .priority-medium {
            background: linear-gradient(135deg, #fdab3d, #fc9003);
            color: white;
        }
        
        .priority-medium::before {
            content: '➖';
            font-size: 10px;
        }
        
        .priority-low {
            background: linear-gradient(135deg, #579bfc, #0073ea);
            color: white;
        }
        
        .priority-low::before {
            content: '▽';
            font-size: 10px;
        }
        
        /* Assignee */
        .assignee-cell {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .assignee-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }
        
        .assignee-name {
            font-size: 13px;
            color: #323338;
        }
        
        /* Date cells */
        .date-cell {
            color: #323338;
            font-size: 13px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .date-cell:hover {
            background: #f0f3f7;
        }
        
        .date-overdue {
            color: #e2445c;
            font-weight: 500;
        }
        
        .date-today {
            color: #fdab3d;
            font-weight: 500;
        }
        
        /* Progress bar - Enhanced */
        .progress-cell {
            width: 120px;
        }
        
        .progress-bar {
            height: 22px;
            background: linear-gradient(135deg, #f0f3f7 0%, #e6e9ef 100%);
            border-radius: 11px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .progress-bar:hover {
            transform: scale(1.05);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00c875 0%, #00d68f 50%, #00a862 100%);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .progress-text {
            font-size: 11px;
            color: white;
            font-weight: 700;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            z-index: 1;
        }
        
        /* Add new item */
        .add-item-row {
            background: #f5f6f8;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .add-item-row:hover {
            background: #e8ebf0;
        }
        
        .add-item-btn {
            color: #0085ff;
            font-weight: 500;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Column resize handle */
        .column-resize-handle {
            position: absolute;
            right: -3px;
            top: 0;
            bottom: 0;
            width: 6px;
            cursor: col-resize;
            background: transparent;
            z-index: 102;
            user-select: none;
        }
        
        .column-resize-handle:hover {
            background: #0073ea;
        }
        
        .column-resize-handle.resizing {
            background: #0073ea;
        }
        
        .resize-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #0073ea;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        
        .resize-line.active {
            display: block;
        }
        
        /* Summary row */
        .summary-row {
            background: #f5f6f8;
            font-weight: 600;
            border-top: 2px solid #e6e9ef;
        }
        
        .summary-row td {
            padding: 12px;
            color: #323338;
        }
        
        /* Dropdown menu */
        .dropdown-menu {
            position: absolute;
            background: white;
            border: 1px solid #e6e9ef;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            padding: 8px;
            z-index: 1000;
            min-width: 200px;
            display: none;
        }
        
        .dropdown-menu.active {
            display: block;
        }
        
        .dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #323338;
        }
        
        .dropdown-item:hover {
            background: #f0f3f7;
        }
        
        .dropdown-item-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #676879;
        }
        
        /* Column type selector */
        .column-type-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #e6e9ef;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            padding: 8px;
            z-index: 1001;
            width: 250px;
            display: none;
        }
        
        .column-type-menu.active {
            display: block;
        }
        
        .column-type-header {
            padding: 8px 12px;
            font-size: 12px;
            color: #676879;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .column-type-item {
            padding: 10px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .column-type-item:hover {
            background: #f0f3f7;
        }
        
        .column-type-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f3f7;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .column-type-info {
            flex: 1;
        }
        
        .column-type-name {
            font-size: 14px;
            color: #323338;
            font-weight: 500;
        }
        
        .column-type-desc {
            font-size: 12px;
            color: #676879;
            margin-top: 2px;
        }
        
        /* Filter bar */
        .filter-bar {
            padding: 12px 20px;
            background: #f5f6f8;
            border-bottom: 1px solid #e6e9ef;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: white;
            border: 1px solid #e6e9ef;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            background: #f0f3f7;
            border-color: #0085ff;
        }
        
        .filter-btn.active {
            background: #0085ff;
            color: white;
            border-color: #0085ff;
        }
        
        /* Batch Action Bar */
        .batch-action-bar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--monday-dark);
            color: white;
            padding: 12px 24px;
            border-radius: 100px;
            display: none;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }
        
        .batch-action-bar.active {
            display: flex;
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        .batch-count {
            font-weight: 600;
            padding-right: 20px;
            border-right: 1px solid rgba(255,255,255,0.2);
        }
        
        .batch-action {
            background: transparent;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }
        
        .batch-action:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .batch-action.danger:hover {
            background: var(--monday-danger);
        }
        
        .batch-close {
            margin-left: 20px;
            padding-left: 20px;
            border-left: 1px solid rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <!-- Authentication Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-sidebar">
            <h1>Windows & Doors CRM</h1>
            <p>Professional contractor management system designed specifically for window and door installation businesses.</p>
            <ul class="features">
                <li>Customer & Lead Management</li>
                <li>Measurement Calculator</li>
                <li>Automated Estimates</li>
                <li>Workflow Tracking</li>
                <li>Team Collaboration</li>
                <li>Professional Quotes</li>
            </ul>
        </div>
        <div class="auth-main">
            <div class="auth-header">
                <h2>Welcome Back</h2>
                <p>Sign in to your account or create a new company</p>
            </div>
            
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('login')">Sign In</button>
                <button class="tab-btn" onclick="switchTab('signup')">Sign Up Company</button>
            </div>
            
            <!-- Login Form -->
            <div id="loginTab" class="tab-content active">
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" name="email" required placeholder="john@windowcompany.com">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" name="password" required placeholder="Enter your password">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Sign In</button>
                </form>
                
                <div class="divider">
                    <span>OR</span>
                </div>
                
                <button class="btn demo-btn btn-block" onclick="loginDemo()">Try Demo Account</button>
            </div>
            
            <!-- Signup Form -->
            <div id="signupTab" class="tab-content">
                <form id="signupForm" onsubmit="handleSignup(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Company Name</label>
                            <input type="text" name="company" required placeholder="ABC Windows & Doors">
                        </div>
                        <div class="form-group">
                            <label>Business Type</label>
                            <select name="businessType" required>
                                <option value="">Select Type</option>
                                <option value="windows">Windows Only</option>
                                <option value="doors">Doors Only</option>
                                <option value="both">Windows & Doors</option>
                                <option value="general">General Contractor</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Your Name</label>
                            <input type="text" name="name" required placeholder="John Smith">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" name="phone" required placeholder="(555) 123-4567">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" name="email" required placeholder="john@company.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" name="password" required placeholder="Create a strong password">
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-block">Create Company Account</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Main Application -->
    <div class="app-container" id="appContainer">
        <nav class="navbar">
            <div class="navbar-brand">🏠 Windows & Doors CRM</div>
            <div class="navbar-menu">
                <a href="#" class="nav-link active" onclick="showSection('dashboard')">Dashboard</a>
                <a href="#" class="nav-link" onclick="showSection('customers')">Customers</a>
                <a href="#" class="nav-link" onclick="showSection('estimation')">Estimation</a>
                <a href="#" class="nav-link" onclick="showSection('workflow')">Workflow</a>
                <a href="#" class="nav-link" onclick="showSection('quotes')">Quotes</a>
            </div>
            <div class="user-menu">
                <span id="companyName">Demo Company</span>
                <div class="user-avatar" id="userAvatar">JS</div>
                <button class="btn" onclick="logout()">Logout</button>
            </div>
        </nav>
        
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section active">
                <div class="dashboard-header">
                    <h1>Dashboard</h1>
                    <p>Welcome back! Here's your business overview.</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Active Leads</h3>
                        <div class="stat-value">24</div>
                        <div class="stat-change">+12% from last month</div>
                    </div>
                    <div class="stat-card">
                        <h3>Quotes Sent</h3>
                        <div class="stat-value">18</div>
                        <div class="stat-change">+5 this week</div>
                    </div>
                    <div class="stat-card">
                        <h3>Jobs in Progress</h3>
                        <div class="stat-value">7</div>
                        <div class="stat-change">3 completing this week</div>
                    </div>
                    <div class="stat-card">
                        <h3>Revenue (Month)</h3>
                        <div class="stat-value">$47,250</div>
                        <div class="stat-change">+28% from last month</div>
                    </div>
                </div>
                
                <div class="workflow-section">
                    <div class="workflow-header">
                        <h2>Current Workflow</h2>
                        <button class="btn btn-primary" onclick="showNewJobModal()">+ New Job</button>
                    </div>
                    <div class="workflow-stages">
                        <div class="stage-column">
                            <div class="stage-header">📋 Leads (5)</div>
                            <div class="job-card" onclick="openCustomerProfile('Sarah Johnson', 'JOB-001', '5 Windows • Residential')">
                                <h4>Sarah Johnson</h4>
                                <p>5 Windows • Residential</p>
                            </div>
                            <div class="job-card" onclick="openCustomerProfile('Mike Chen', 'JOB-002', 'French Doors • Commercial')">
                                <h4>Mike Chen</h4>
                                <p>French Doors • Commercial</p>
                            </div>
                        </div>
                        <div class="stage-column">
                            <div class="stage-header">📝 Quotes (3)</div>
                            <div class="job-card" onclick="openCustomerProfile('ABC Office Building', 'JOB-003', '12 Windows • $18,500')">
                                <h4>ABC Office Building</h4>
                                <p>12 Windows • $18,500</p>
                            </div>
                        </div>
                        <div class="stage-column">
                            <div class="stage-header">✅ Approved (2)</div>
                            <div class="job-card" onclick="openCustomerProfile('Residential Complex', 'JOB-004', 'Ready for scheduling')">
                                <h4>Residential Complex</h4>
                                <p>Ready for scheduling</p>
                            </div>
                        </div>
                        <div class="stage-column">
                            <div class="stage-header">🔨 Installation (2)</div>
                            <div class="job-card" onclick="openCustomerProfile('Thompson Residence', 'JOB-005', 'Day 2 of 3')">
                                <h4>Thompson Residence</h4>
                                <p>Day 2 of 3</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Estimation Section -->
            <div id="estimationSection" class="section" style="display: none;">
                <div class="estimation-tool">
                    <div class="estimation-header">
                        <h2>Quick Estimation Tool</h2>
                        <p>Calculate accurate estimates based on measurements</p>
                    </div>
                    
                    <div class="product-selector">
                        <div class="product-card" onclick="selectProduct('window-double')">
                            <div class="product-icon">🪟</div>
                            <div>Double Hung</div>
                        </div>
                        <div class="product-card" onclick="selectProduct('window-casement')">
                            <div class="product-icon">🪟</div>
                            <div>Casement</div>
                        </div>
                        <div class="product-card" onclick="selectProduct('window-sliding')">
                            <div class="product-icon">🪟</div>
                            <div>Sliding</div>
                        </div>
                        <div class="product-card" onclick="selectProduct('door-entry')">
                            <div class="product-icon">🚪</div>
                            <div>Entry Door</div>
                        </div>
                        <div class="product-card" onclick="selectProduct('door-french')">
                            <div class="product-icon">🚪</div>
                            <div>French Doors</div>
                        </div>
                        <div class="product-card" onclick="selectProduct('door-sliding')">
                            <div class="product-icon">🚪</div>
                            <div>Sliding Doors</div>
                        </div>
                    </div>
                    
                    <div class="measurement-form">
                        <div class="measurement-input">
                            <label>Width</label>
                            <div class="input-group">
                                <input type="number" id="widthInput" placeholder="36" onchange="calculateEstimate()">
                                <span>inches</span>
                            </div>
                        </div>
                        <div class="measurement-input">
                            <label>Height</label>
                            <div class="input-group">
                                <input type="number" id="heightInput" placeholder="60" onchange="calculateEstimate()">
                                <span>inches</span>
                            </div>
                        </div>
                        <div class="measurement-input">
                            <label>Quantity</label>
                            <div class="input-group">
                                <input type="number" id="quantityInput" value="1" min="1" onchange="calculateEstimate()">
                                <span>units</span>
                            </div>
                        </div>
                        <div class="measurement-input">
                            <label>Material</label>
                            <select id="materialSelect" onchange="calculateEstimate()">
                                <option value="vinyl">Vinyl</option>
                                <option value="wood">Wood</option>
                                <option value="aluminum">Aluminum</option>
                                <option value="fiberglass">Fiberglass</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="calculation-results">
                        <div class="result-row">
                            <span>Base Price:</span>
                            <span id="basePrice">$0</span>
                        </div>
                        <div class="result-row">
                            <span>Material Cost:</span>
                            <span id="materialCost">$0</span>
                        </div>
                        <div class="result-row">
                            <span>Installation:</span>
                            <span id="installationCost">$0</span>
                        </div>
                        <div class="result-row">
                            <span>Total Estimate:</span>
                            <span id="totalEstimate">$0</span>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="btn btn-primary" onclick="saveEstimate()">Save Estimate</button>
                        <button class="btn demo-btn" onclick="generateQuote()">Generate Quote</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Job Modal -->
    <div class="modal" id="newJobModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Job</h3>
                <button class="modal-close" onclick="closeModal('newJobModal')">×</button>
            </div>
            <form onsubmit="createNewJob(event)">
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" required placeholder="Enter customer name">
                </div>
                <div class="form-group">
                    <label>Project Type</label>
                    <select required>
                        <option value="">Select Type</option>
                        <option value="windows">Windows Installation</option>
                        <option value="doors">Doors Installation</option>
                        <option value="both">Windows & Doors</option>
                        <option value="repair">Repair/Replacement</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <input type="text" required placeholder="Installation address">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" required placeholder="Customer phone">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Create Job</button>
            </form>
        </div>
    </div>

    <!-- Customer Profile Modal -->
    <div id="customerProfileModal" class="modal customer-profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h2 id="profileCustomerName">Customer Name</h2>
                    <span class="profile-subtitle" id="profileJobNumber">Job #</span>
                </div>
                <button class="modal-close" onclick="closeModal('customerProfileModal')">×</button>
            </div>
            
            <div class="profile-tabs">
                <button class="tab-btn active" onclick="switchProfileTab('details')">Details</button>
                <button class="tab-btn" onclick="switchProfileTab('workflow')">Workflow</button>
                <button class="tab-btn" onclick="switchProfileTab('estimates')">Estimates</button>
                <button class="tab-btn" onclick="switchProfileTab('files')">Files</button>
                <button class="tab-btn" onclick="switchProfileTab('history')">History</button>
                <button class="tab-btn" onclick="switchProfileTab('notes')">Notes</button>
            </div>
            
            <div class="profile-content">
                <!-- Details Tab -->
                <div id="detailsTab" class="tab-content active">
                    <div class="profile-section">
                        <h3>Contact Information</h3>
                        <div class="detail-row">
                            <label>Full Name</label>
                            <input type="text" class="form-control" id="profileFullName">
                        </div>
                        <div class="detail-row">
                            <label>Phone</label>
                            <input type="tel" class="form-control" id="profilePhone">
                        </div>
                        <div class="detail-row">
                            <label>Email</label>
                            <input type="email" class="form-control" id="profileEmail">
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <h3>Address</h3>
                        <div class="detail-row">
                            <label>Street Address</label>
                            <input type="text" class="form-control" id="profileAddress">
                        </div>
                        <div class="detail-row">
                            <label>City</label>
                            <input type="text" class="form-control" id="profileCity">
                        </div>
                        <div class="detail-row">
                            <label>State</label>
                            <input type="text" class="form-control" id="profileState">
                        </div>
                        <div class="detail-row">
                            <label>ZIP Code</label>
                            <input type="text" class="form-control" id="profileZip">
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <h3>Job Details</h3>
                        <div class="detail-row">
                            <label>Job Type</label>
                            <select class="form-control" id="profileJobType">
                                <option value="replacement">Full Replacement</option>
                                <option value="installation">New Installation</option>
                                <option value="repair">Repair</option>
                            </select>
                        </div>
                        <div class="detail-row">
                            <label>Status</label>
                            <select class="form-control" id="profileStatus">
                                <option value="lead">Lead</option>
                                <option value="quoted">Quoted</option>
                                <option value="scheduled">Scheduled</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="detail-row">
                            <label>Scheduled Date</label>
                            <input type="date" class="form-control" id="profileScheduledDate">
                        </div>
                    </div>
                    
                    <div class="profile-actions">
                        <button class="btn btn-primary" onclick="saveCustomerDetails()">Save Changes</button>
                    </div>
                </div>
                
                <!-- Workflow Tab -->
                <div id="workflowTab" class="tab-content">
                    <div class="monday-board">
                        <div class="board-header">
                            <div class="board-title-section">
                                <div class="board-title">
                                    <div class="board-title-icon">📋</div>
                                    <span>Project Tasks</span>
                                </div>
                            </div>
                            <div class="board-actions">
                                <div class="search-box">
                                    <span class="search-icon">🔍</span>
                                    <input type="text" class="search-input" placeholder="Search..." onkeyup="searchTasks(this.value)">
                                </div>
                                <div class="view-switcher">
                                    <button class="view-btn active" onclick="switchView('table')">Table</button>
                                    <button class="view-btn" onclick="switchView('cards')">Cards</button>
                                    <button class="view-btn" onclick="switchView('timeline')">Timeline</button>
                                </div>
                                <button class="btn btn-primary" onclick="addNewItem()">+ New Item</button>
                            </div>
                        </div>
                        
                        <div class="filter-bar">
                            <button class="filter-btn" onclick="filterMondayTasks('all')">All Items</button>
                            <button class="filter-btn" onclick="filterMondayTasks('my')">My Items</button>
                            <button class="filter-btn" onclick="groupBy('status')">Group by Status</button>
                            <button class="filter-btn" onclick="groupBy('priority')">Group by Priority</button>
                        </div>
                        
                        <div class="board-table-wrapper" id="tableWrapper">
                            <div class="resize-line" id="resizeLine"></div>
                            <table class="board-table">
                            <thead>
                                <tr>
                                    <th class="checkbox-cell" style="width: 40px;">
                                        <input type="checkbox" class="row-checkbox" onclick="selectAllRows(this)">
                                        <div class="column-resize-handle" onmousedown="startResize(event, this)"></div>
                                    </th>
                                    <th class="item-id-cell" style="width: 90px;">
                                        <div class="column-header">
                                            <div class="column-header-content">
                                                <span class="column-icon">🔢</span>
                                                <span class="column-name">Item ID</span>
                                            </div>
                                        </div>
                                        <div class="column-resize-handle" onmousedown="startResize(event, this)"></div>
                                    </th>
                                    <th style="width: 40px;">
                                        <div class="column-resize-handle" onmousedown="startResize(event, this)"></div>
                                    </th>
                                    <th style="width: 300px;">
                                        <div class="column-header">
                                            <div class="column-header-content">
                                                <span class="column-icon">📝</span>
                                                <span class="column-name">Task</span>
                                            </div>
                                            <div class="column-actions">
                                                <button class="column-action-btn" onclick="sortColumn('task')">↕</button>
                                            </div>
                                        </div>
                                        <div class="column-resize-handle" onmousedown="startResize(event, this)"></div>
                                    </th>
                                    <th style="width: 140px;">
                                        <div class="column-header" onclick="showColumnTypeMenu(this, 'status')">
                                            <div class="column-header-content">
                                                <span class="column-icon">🔵</span>
                                                <span class="column-name">Status</span>
                                            </div>
                                            <div class="column-actions">
                                                <button class="column-action-btn" onclick="editColumn(event, 'status')">✏️</button>
                                                <button class="column-action-btn" onclick="deleteColumn(event, 'status')">×</button>
                                            </div>
                                        </div>
                                        <div class="column-resize-handle" onmousedown="startResize(event, this)"></div>
                                    </th>
                                    <th style="width: 140px;">
                                        <div class="column-header" onclick="showColumnTypeMenu(this, 'priority')">
                                            <div class="column-header-content">
                                                <span class="column-icon">⚡</span>
                                                <span class="column-name">Priority</span>
                                            </div>
                                            <div class="column-actions">
                                                <button class="column-action-btn" onclick="editColumn(event, 'priority')">✏️</button>
                                                <button class="column-action-btn" onclick="deleteColumn(event, 'priority')">×</button>
                                            </div>
                                        </div>
                                    </th>
                                    <th style="width: 150px;">
                                        <div class="column-header" onclick="showColumnTypeMenu(this, 'person')">
                                            <div class="column-header-content">
                                                <span class="column-icon">👤</span>
                                                <span class="column-name">Person</span>
                                            </div>
                                            <div class="column-actions">
                                                <button class="column-action-btn" onclick="editColumn(event, 'person')">✏️</button>
                                                <button class="column-action-btn" onclick="deleteColumn(event, 'person')">×</button>
                                            </div>
                                        </div>
                                    </th>
                                    <th style="width: 120px;">
                                        <div class="column-header" onclick="showColumnTypeMenu(this, 'date')">
                                            <div class="column-header-content">
                                                <span class="column-icon">📅</span>
                                                <span class="column-name">Due Date</span>
                                            </div>
                                            <div class="column-actions">
                                                <button class="column-action-btn" onclick="editColumn(event, 'date')">✏️</button>
                                                <button class="column-action-btn" onclick="deleteColumn(event, 'date')">×</button>
                                            </div>
                                        </div>
                                    </th>
                                    <th style="width: 150px;">
                                        <div class="column-header" onclick="showColumnTypeMenu(this, 'progress')">
                                            <div class="column-header-content">
                                                <span class="column-icon">📊</span>
                                                <span class="column-name">Progress</span>
                                            </div>
                                            <div class="column-actions">
                                                <button class="column-action-btn" onclick="editColumn(event, 'progress')">✏️</button>
                                                <button class="column-action-btn" onclick="deleteColumn(event, 'progress')">×</button>
                                            </div>
                                        </div>
                                    </th>
                                    <th class="add-column-btn" onclick="showAddColumnMenu(this)"></th>
                                </tr>
                            </thead>
                            <tbody id="mondayTableBody">
                                <!-- Item 1 with subitems -->
                                <tr class="item-row" data-item-id="1">
                                    <td class="checkbox-cell">
                                        <input type="checkbox" class="row-checkbox" onclick="selectRow(this)">
                                    </td>
                                    <td class="item-id-cell">
                                        <span class="item-id" onclick="copyItemId(this)">ITEM-1001</span>
                                        <span class="item-id-tooltip">Click to copy</span>
                                    </td>
                                    <td>
                                        <button class="expand-btn expanded" onclick="toggleSubitems(1)">▶</button>
                                    </td>
                                    <td>
                                        <div class="cell-content">
                                            <input type="text" class="task-input" value="Site Measurement & Assessment" onblur="updateTask(this)">
                                        </div>
                                    </td>
                                    <td>
                                        <div class="cell-content">
                                            <span class="status-pill status-working" onclick="changeStatus(this)">Working on it</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="cell-content">
                                            <span class="priority-pill priority-high" onclick="changePriority(this)">High</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="cell-content">
                                            <div class="assignee-cell" onclick="changeAssignee(this)">
                                                <span class="assignee-avatar">JD</span>
                                                <span class="assignee-name">John Doe</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="cell-content">
                                            <span class="date-cell date-overdue" onclick="changeDate(this)">Dec 10</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="cell-content">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: 60%;">
                                                    <span class="progress-text">60%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td></td>
                                </tr>
                                
                                <!-- Subitems for Item 1 -->
                                <tr class="subitem-row" data-parent-id="1">
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <div class="task-name">
                                            <input type="text" class="task-input" value="Take photos of existing windows" onblur="updateTask(this)">
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-pill status-done" onclick="changeStatus(this)">Done</span>
                                    </td>
                                    <td>
                                        <span class="priority-pill priority-medium" onclick="changePriority(this)">Medium</span>
                                    </td>
                                    <td>
                                        <div class="assignee-cell" onclick="changeAssignee(this)">
                                            <span class="assignee-avatar">JD</span>
                                            <span class="assignee-name">John Doe</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="date-cell" onclick="changeDate(this)">Dec 8</span>
                                    </td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 100%;">
                                                <span class="progress-text">100%</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="time-est">1h</span>
                                    </td>
                                </tr>
                                
                                <tr class="subitem-row" data-parent-id="1">
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                        <div class="task-name">
                                            <input type="text" class="task-input" value="Measure all window dimensions" onblur="updateTask(this)">
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-pill status-working" onclick="changeStatus(this)">Working on it</span>
                                    </td>
                                    <td>
                                        <span class="priority-pill priority-high" onclick="changePriority(this)">High</span>
                                    </td>
                                    <td>
                                        <div class="assignee-cell" onclick="changeAssignee(this)">
                                            <span class="assignee-avatar">JD</span>
                                            <span class="assignee-name">John Doe</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="date-cell date-today" onclick="changeDate(this)">Today</span>
                                    </td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 50%;">
                                                <span class="progress-text">50%</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="time-est">2h</span>
                                    </td>
                                </tr>
                                
                                <!-- Item 2 -->
                                <tr class="item-row" data-item-id="2">
                                    <td class="checkbox-cell">
                                        <input type="checkbox" class="row-checkbox" onclick="selectRow(this)">
                                    </td>
                                    <td class="item-id-cell">
                                        <span class="item-id" onclick="copyItemId(this)">ITEM-1002</span>
                                        <span class="item-id-tooltip">Click to copy</span>
                                    </td>
                                    <td>
                                        <button class="expand-btn" onclick="toggleSubitems(2)">▶</button>
                                    </td>
                                    <td>
                                        <div class="task-name">
                                            <input type="text" class="task-input" value="Quote Preparation" onblur="updateTask(this)">
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-pill status-waiting" onclick="changeStatus(this)">Waiting</span>
                                    </td>
                                    <td>
                                        <span class="priority-pill priority-medium" onclick="changePriority(this)">Medium</span>
                                    </td>
                                    <td>
                                        <div class="assignee-cell" onclick="changeAssignee(this)">
                                            <span class="assignee-avatar">SM</span>
                                            <span class="assignee-name">Sales Manager</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="date-cell" onclick="changeDate(this)">Dec 15</span>
                                    </td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 0%;">
                                                <span class="progress-text">0%</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="time-est">4h</span>
                                    </td>
                                </tr>
                                
                                <!-- Item 3 -->
                                <tr class="item-row" data-item-id="3">
                                    <td class="checkbox-cell">
                                        <input type="checkbox" class="row-checkbox" onclick="selectRow(this)">
                                    </td>
                                    <td class="item-id-cell">
                                        <span class="item-id" onclick="copyItemId(this)">ITEM-1003</span>
                                        <span class="item-id-tooltip">Click to copy</span>
                                    </td>
                                    <td>
                                        <button class="expand-btn" onclick="toggleSubitems(3)">▶</button>
                                    </td>
                                    <td>
                                        <div class="task-name">
                                            <input type="text" class="task-input" value="Customer Approval" onblur="updateTask(this)">
                                        </div>
                                    </td>
                                    <td>
                                        <span class="status-pill status-stuck" onclick="changeStatus(this)">Stuck</span>
                                    </td>
                                    <td>
                                        <span class="priority-pill priority-critical" onclick="changePriority(this)">Critical</span>
                                    </td>
                                    <td>
                                        <div class="assignee-cell" onclick="changeAssignee(this)">
                                            <span class="assignee-avatar">AB</span>
                                            <span class="assignee-name">Alice Brown</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="date-cell date-overdue" onclick="changeDate(this)">Dec 5</span>
                                    </td>
                                    <td>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 80%;">
                                                <span class="progress-text">80%</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="time-est">1h</span>
                                    </td>
                                </tr>
                                
                                <!-- Add new item row -->
                                <tr class="add-item-row">
                                    <td colspan="8">
                                        <div class="add-item-btn" onclick="addNewItem()">
                                            + Add Item
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                            
                            <!-- Summary row -->
                            <tfoot>
                                <tr class="summary-row">
                                    <td colspan="2">Total: 3 Items</td>
                                    <td colspan="6">
                                        <span style="color: #00c875;">1 Done</span> •
                                        <span style="color: #fdab3d;">1 Working</span> •
                                        <span style="color: #e2445c;">1 Stuck</span>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                        </div>
                        
                        <!-- Batch Action Bar -->
                        <div id="batchActionBar" class="batch-action-bar">
                            <span class="batch-count"><span id="selectedCount">0</span> items selected</span>
                            <button class="batch-action" onclick="batchChangeStatus()">
                                <span>🔄</span> Change Status
                            </button>
                            <button class="batch-action" onclick="batchAssign()">
                                <span>👤</span> Assign
                            </button>
                            <button class="batch-action" onclick="batchDuplicate()">
                                <span>📋</span> Duplicate
                            </button>
                            <button class="batch-action danger" onclick="batchDelete()">
                                <span>🗑️</span> Delete
                            </button>
                            <button class="batch-action batch-close" onclick="clearSelection()">
                                <span>✕</span> Clear
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Estimates Tab -->
                <div id="estimatesTab" class="tab-content">
                    <div class="estimates-header">
                        <h3>Estimates & Quotes</h3>
                        <button class="btn btn-primary" onclick="createNewEstimate()">New Estimate</button>
                    </div>
                    <div class="estimates-list" id="estimatesList">
                        <!-- Estimates will be loaded here -->
                    </div>
                </div>
                
                <!-- Files Tab -->
                <div id="filesTab" class="tab-content">
                    <div class="files-header">
                        <h3>Documents & Files</h3>
                        <button class="btn btn-primary" onclick="uploadFile()">Upload File</button>
                    </div>
                    <div class="files-grid" id="filesGrid">
                        <!-- Files will be loaded here -->
                    </div>
                </div>
                
                <!-- History Tab -->
                <div id="historyTab" class="tab-content">
                    <h3>Activity History</h3>
                    <div class="history-timeline" id="historyTimeline">
                        <!-- History items will be loaded here -->
                    </div>
                </div>
                
                <!-- Notes Tab -->
                <div id="notesTab" class="tab-content">
                    <div class="notes-header">
                        <h3>Notes</h3>
                        <button class="btn btn-primary" onclick="addNote()">Add Note</button>
                    </div>
                    <div class="notes-list" id="notesList">
                        <!-- Notes will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // State management
        let currentUser = null;
        let currentCompany = null;
        let selectedProduct = null;
        let currentCustomer = null;
        
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('loginTab').classList.add('active');
            } else {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('signupTab').classList.add('active');
            }
        }
        
        // Authentication handlers
        async function handleLogin(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentUser = result.user;
                    currentCompany = result.company;
                    localStorage.setItem('token', result.token);
                    showApp();
                } else {
                    alert('Invalid credentials. Try the demo account!');
                }
            } catch (error) {
                // For demo, just show the app
                loginDemo();
            }
        }
        
        async function handleSignup(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch('/api/auth/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    currentUser = result.user;
                    currentCompany = result.company;
                    localStorage.setItem('token', result.token);
                    showApp();
                } else {
                    alert('Signup failed. Please try again.');
                }
            } catch (error) {
                alert('Company account created! (Demo mode)');
                loginDemo();
            }
        }
        
        function loginDemo() {
            currentUser = { name: 'John Smith', email: 'demo@windowscrm.com' };
            currentCompany = { name: 'Demo Windows & Doors Co.' };
            showApp();
        }
        
        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('companyName').textContent = currentCompany.name;
            document.getElementById('userAvatar').textContent = currentUser.name.split(' ').map(n => n[0]).join('');
        }
        
        function logout() {
            localStorage.removeItem('token');
            currentUser = null;
            currentCompany = null;
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }
        
        // Section navigation
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            if (section === 'dashboard') {
                document.getElementById('dashboardSection').style.display = 'block';
                document.querySelectorAll('.nav-link')[0].classList.add('active');
            } else if (section === 'estimation') {
                document.getElementById('estimationSection').style.display = 'block';
                document.querySelectorAll('.nav-link')[2].classList.add('active');
            }
        }
        
        // Product selection
        function selectProduct(product) {
            selectedProduct = product;
            document.querySelectorAll('.product-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.product-card').classList.add('selected');
            calculateEstimate();
        }
        
        // Estimation calculator
        function calculateEstimate() {
            const width = parseFloat(document.getElementById('widthInput').value) || 0;
            const height = parseFloat(document.getElementById('heightInput').value) || 0;
            const quantity = parseInt(document.getElementById('quantityInput').value) || 1;
            const material = document.getElementById('materialSelect').value;
            
            if (width === 0 || height === 0 || !selectedProduct) {
                document.getElementById('totalEstimate').textContent = '$0';
                return;
            }
            
            // Calculate square footage
            const sqft = (width * height) / 144; // Convert to square feet
            
            // Base pricing per square foot
            const basePrices = {
                'window-double': 45,
                'window-casement': 55,
                'window-sliding': 40,
                'door-entry': 250,
                'door-french': 180,
                'door-sliding': 120
            };
            
            // Material multipliers
            const materialMultipliers = {
                'vinyl': 1.0,
                'wood': 1.5,
                'aluminum': 1.2,
                'fiberglass': 1.8
            };
            
            const basePrice = sqft * (basePrices[selectedProduct] || 50) * quantity;
            const materialCost = basePrice * (materialMultipliers[material] - 1);
            const installationCost = basePrice * 0.35; // 35% for installation
            const totalEstimate = basePrice + materialCost + installationCost;
            
            // Update display
            document.getElementById('basePrice').textContent = `$${basePrice.toFixed(2)}`;
            document.getElementById('materialCost').textContent = `$${materialCost.toFixed(2)}`;
            document.getElementById('installationCost').textContent = `$${installationCost.toFixed(2)}`;
            document.getElementById('totalEstimate').textContent = `$${totalEstimate.toFixed(2)}`;
        }
        
        // Modal functions
        function showNewJobModal() {
            document.getElementById('newJobModal').classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function createNewJob(event) {
            event.preventDefault();
            alert('New job created successfully!');
            closeModal('newJobModal');
        }
        
        function saveEstimate() {
            alert('Estimate saved successfully!');
        }
        
        function generateQuote() {
            alert('Professional quote generated and ready to send!');
        }
        
        // Customer Profile Functions
        function openCustomerProfile(name, jobNumber, description) {
            currentCustomer = {
                name: name,
                jobNumber: jobNumber,
                description: description,
                phone: '(555) 123-4567',
                email: name.toLowerCase().replace(/\s+/g, '.') + '@email.com',
                address: '123 Main St',
                city: 'New York',
                state: 'NY',
                zip: '10001'
            };
            
            // Populate profile modal
            document.getElementById('profileCustomerName').textContent = name;
            document.getElementById('profileJobNumber').textContent = jobNumber;
            document.getElementById('profileFullName').value = name;
            document.getElementById('profilePhone').value = currentCustomer.phone;
            document.getElementById('profileEmail').value = currentCustomer.email;
            document.getElementById('profileAddress').value = currentCustomer.address;
            document.getElementById('profileCity').value = currentCustomer.city;
            document.getElementById('profileState').value = currentCustomer.state;
            document.getElementById('profileZip').value = currentCustomer.zip;
            
            // Load estimates
            loadCustomerEstimates();
            
            // Show modal
            document.getElementById('customerProfileModal').classList.add('active');
        }
        
        function switchProfileTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.customer-profile-modal .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.customer-profile-modal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(tab + 'Tab').classList.add('active');
            
            // Load tab-specific data
            if (tab === 'workflow') {
                initializeWorkflowBoard();
            } else if (tab === 'estimates') {
                loadCustomerEstimates();
            } else if (tab === 'files') {
                loadCustomerFiles();
            } else if (tab === 'history') {
                loadCustomerHistory();
            } else if (tab === 'notes') {
                loadCustomerNotes();
            }
        }
        
        function saveCustomerDetails() {
            // Gather updated data
            const updatedCustomer = {
                name: document.getElementById('profileFullName').value,
                phone: document.getElementById('profilePhone').value,
                email: document.getElementById('profileEmail').value,
                address: document.getElementById('profileAddress').value,
                city: document.getElementById('profileCity').value,
                state: document.getElementById('profileState').value,
                zip: document.getElementById('profileZip').value,
                jobType: document.getElementById('profileJobType').value,
                status: document.getElementById('profileStatus').value,
                scheduledDate: document.getElementById('profileScheduledDate').value
            };
            
            // In production, send to backend
            console.log('Saving customer details:', updatedCustomer);
            alert('Customer details saved successfully!');
        }
        
        function loadCustomerEstimates() {
            const estimatesList = document.getElementById('estimatesList');
            estimatesList.innerHTML = `
                <div class="estimate-card">
                    <div class="estimate-header">
                        <h4>Quote #Q-001</h4>
                        <span class="estimate-status">Sent</span>
                    </div>
                    <div class="estimate-details">
                        <p>5 Double Hung Windows</p>
                        <p class="estimate-price">$12,500</p>
                    </div>
                    <div class="estimate-actions">
                        <button class="btn btn-secondary" onclick="viewEstimate('Q-001')">View PDF</button>
                        <button class="btn btn-primary" onclick="editEstimate('Q-001')">Edit</button>
                    </div>
                </div>
                <div class="estimate-card">
                    <div class="estimate-header">
                        <h4>Quote #Q-002</h4>
                        <span class="estimate-status draft">Draft</span>
                    </div>
                    <div class="estimate-details">
                        <p>2 French Doors + Installation</p>
                        <p class="estimate-price">$8,200</p>
                    </div>
                    <div class="estimate-actions">
                        <button class="btn btn-secondary" onclick="viewEstimate('Q-002')">Preview</button>
                        <button class="btn btn-primary" onclick="editEstimate('Q-002')">Complete</button>
                    </div>
                </div>
            `;
        }
        
        function loadCustomerFiles() {
            const filesGrid = document.getElementById('filesGrid');
            filesGrid.innerHTML = `
                <div class="file-item">
                    <div class="file-icon">📄</div>
                    <div class="file-info">
                        <div class="file-name">Initial_Quote.pdf</div>
                        <div class="file-meta">2.3 MB • 2 days ago</div>
                    </div>
                </div>
                <div class="file-item">
                    <div class="file-icon">📷</div>
                    <div class="file-info">
                        <div class="file-name">Site_Photos.zip</div>
                        <div class="file-meta">15.8 MB • 1 week ago</div>
                    </div>
                </div>
                <div class="file-item">
                    <div class="file-icon">📊</div>
                    <div class="file-info">
                        <div class="file-name">Measurements.xlsx</div>
                        <div class="file-meta">45 KB • 3 days ago</div>
                    </div>
                </div>
            `;
        }
        
        function loadCustomerHistory() {
            const historyTimeline = document.getElementById('historyTimeline');
            historyTimeline.innerHTML = `
                <div class="history-item">
                    <div class="history-date">Today, 2:30 PM</div>
                    <div class="history-content">
                        <strong>Quote Sent</strong>
                        <p>Quote #Q-001 emailed to customer</p>
                    </div>
                </div>
                <div class="history-item">
                    <div class="history-date">Yesterday, 10:15 AM</div>
                    <div class="history-content">
                        <strong>Site Visit Completed</strong>
                        <p>Measurements taken and photos uploaded</p>
                    </div>
                </div>
                <div class="history-item">
                    <div class="history-date">3 days ago</div>
                    <div class="history-content">
                        <strong>Lead Created</strong>
                        <p>Customer inquiry received via website</p>
                    </div>
                </div>
            `;
        }
        
        function loadCustomerNotes() {
            const notesList = document.getElementById('notesList');
            notesList.innerHTML = `
                <div class="note-item">
                    <div class="note-header">
                        <strong>Sales Team</strong>
                        <span class="note-time">2 hours ago</span>
                    </div>
                    <p>Customer prefers morning appointments. Best contact time is between 9-11 AM.</p>
                </div>
                <div class="note-item">
                    <div class="note-header">
                        <strong>Site Inspector</strong>
                        <span class="note-time">Yesterday</span>
                    </div>
                    <p>Foundation needs reinforcement for door installation. Added to quote.</p>
                </div>
            `;
        }
        
        function createNewEstimate() {
            alert('Opening estimate builder...');
            // In production, navigate to estimation tool with customer pre-filled
        }
        
        function viewEstimate(id) {
            alert(`Opening PDF for estimate ${id}...`);
            // In production, open PDF viewer or download
        }
        
        function editEstimate(id) {
            alert(`Opening estimate ${id} for editing...`);
            // In production, navigate to estimation tool with estimate loaded
        }
        
        function uploadFile() {
            alert('File upload dialog would open here');
            // In production, open file upload dialog
        }
        
        function addNote() {
            const note = prompt('Enter your note:');
            if (note) {
                alert('Note added successfully!');
                loadCustomerNotes();
            }
        }
        
        // Monday.com Board Functions - Enhanced
        let itemIdCounter = 10;
        let selectedRows = new Set();
        let availableColumns = {
            text: { icon: '📝', name: 'Text', desc: 'Simple text field' },
            status: { icon: '🔵', name: 'Status', desc: 'Colored status labels' },
            person: { icon: '👤', name: 'Person', desc: 'Team member assignment' },
            date: { icon: '📅', name: 'Date', desc: 'Date picker' },
            timeline: { icon: '📊', name: 'Timeline', desc: 'Date range' },
            number: { icon: '🔢', name: 'Number', desc: 'Numeric values' },
            checkbox: { icon: '☑️', name: 'Checkbox', desc: 'Yes/No checkbox' },
            dropdown: { icon: '📋', name: 'Dropdown', desc: 'Select from list' },
            link: { icon: '🔗', name: 'Link', desc: 'URL links' },
            email: { icon: '📧', name: 'Email', desc: 'Email addresses' },
            phone: { icon: '📞', name: 'Phone', desc: 'Phone numbers' },
            rating: { icon: '⭐', name: 'Rating', desc: 'Star rating' },
            progress: { icon: '📊', name: 'Progress', desc: 'Progress bar' }
        };
        
        function initializeWorkflowBoard() {
            // Initialize expand/collapse for subitems
            document.querySelectorAll('.subitem-row[data-parent-id="1"]').forEach(row => {
                row.style.display = 'table-row';
            });
            
            // Add click outside handler for dropdowns
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.column-type-menu') && !e.target.closest('.column-header')) {
                    document.querySelectorAll('.column-type-menu').forEach(menu => {
                        menu.classList.remove('active');
                    });
                }
            });
            
            // Load saved column widths
            loadColumnWidths();
            
            // Add resize handles to dynamically added columns
            addResizeHandlesToNewColumns();
        }
        
        function addResizeHandlesToNewColumns() {
            document.querySelectorAll('.board-table thead th').forEach(th => {
                if (!th.querySelector('.column-resize-handle') && !th.classList.contains('add-column-btn')) {
                    const handle = document.createElement('div');
                    handle.className = 'column-resize-handle';
                    handle.onmousedown = function(e) { startResize(e, this); };
                    th.appendChild(handle);
                }
            });
        }
        
        function toggleSubitems(itemId) {
            const button = event.target;
            const subitems = document.querySelectorAll(`.subitem-row[data-parent-id="${itemId}"]`);
            
            if (button.classList.contains('expanded')) {
                button.classList.remove('expanded');
                subitems.forEach(row => row.style.display = 'none');
            } else {
                button.classList.add('expanded');
                subitems.forEach(row => row.style.display = 'table-row');
            }
        }
        
        function changeStatus(element) {
            const statuses = [
                { class: 'status-todo', text: 'Not Started' },
                { class: 'status-working', text: 'Working on it' },
                { class: 'status-stuck', text: 'Stuck' },
                { class: 'status-waiting', text: 'Waiting' },
                { class: 'status-done', text: 'Done' }
            ];
            
            const currentClass = Array.from(element.classList).find(c => c.startsWith('status-'));
            const currentIndex = statuses.findIndex(s => s.class === currentClass);
            const nextIndex = (currentIndex + 1) % statuses.length;
            
            element.className = `status-pill ${statuses[nextIndex].class}`;
            element.textContent = statuses[nextIndex].text;
            
            updateSummary();
        }
        
        function changePriority(element) {
            const priorities = [
                { class: 'priority-low', text: 'Low' },
                { class: 'priority-medium', text: 'Medium' },
                { class: 'priority-high', text: 'High' },
                { class: 'priority-critical', text: 'Critical' }
            ];
            
            const currentClass = Array.from(element.classList).find(c => c.startsWith('priority-'));
            const currentIndex = priorities.findIndex(p => p.class === currentClass);
            const nextIndex = (currentIndex + 1) % priorities.length;
            
            element.className = `priority-pill ${priorities[nextIndex].class}`;
            element.textContent = priorities[nextIndex].text;
        }
        
        function changeAssignee(element) {
            const assignees = [
                { initials: 'JD', name: 'John Doe' },
                { initials: 'SM', name: 'Sales Manager' },
                { initials: 'AB', name: 'Alice Brown' },
                { initials: 'ME', name: 'Me' }
            ];
            
            const currentName = element.querySelector('.assignee-name').textContent;
            const currentIndex = assignees.findIndex(a => a.name === currentName);
            const nextIndex = (currentIndex + 1) % assignees.length;
            
            element.querySelector('.assignee-avatar').textContent = assignees[nextIndex].initials;
            element.querySelector('.assignee-name').textContent = assignees[nextIndex].name;
        }
        
        function changeDate(element) {
            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.value = new Date().toISOString().split('T')[0];
            dateInput.style.position = 'absolute';
            dateInput.style.zIndex = '1000';
            
            dateInput.onchange = function() {
                const date = new Date(this.value);
                const today = new Date();
                const options = { month: 'short', day: 'numeric' };
                
                element.textContent = date.toLocaleDateString('en-US', options);
                
                // Update styling based on date
                element.classList.remove('date-overdue', 'date-today');
                if (date < today) {
                    element.classList.add('date-overdue');
                } else if (date.toDateString() === today.toDateString()) {
                    element.classList.add('date-today');
                }
                
                dateInput.remove();
            };
            
            element.appendChild(dateInput);
            dateInput.click();
        }
        
        function updateTask(input) {
            // In production, save to backend
            console.log('Task updated:', input.value);
        }
        
        function addNewItem() {
            const tbody = document.getElementById('mondayTableBody');
            const addRow = tbody.querySelector('.add-item-row');
            
            const newItemId = ++itemIdCounter;
            const newRow = document.createElement('tr');
            newRow.className = 'item-row';
            newRow.dataset.itemId = newItemId;
            
            const itemId = generateItemId();
            
            newRow.innerHTML = `
                <td class="checkbox-cell">
                    <input type="checkbox" class="row-checkbox" onclick="selectRow(this)">
                </td>
                <td class="item-id-cell">
                    <span class="item-id" onclick="copyItemId(this)">${itemId}</span>
                    <span class="item-id-tooltip">Click to copy</span>
                </td>
                <td>
                    <button class="expand-btn" onclick="toggleSubitems(${newItemId})">▶</button>
                </td>
                <td>
                    <div class="task-name">
                        <input type="text" class="task-input" placeholder="Enter task name..." onblur="updateTask(this)">
                    </div>
                </td>
                <td>
                    <span class="status-pill status-todo" onclick="changeStatus(this)">Not Started</span>
                </td>
                <td>
                    <span class="priority-pill priority-medium" onclick="changePriority(this)">Medium</span>
                </td>
                <td>
                    <div class="assignee-cell" onclick="changeAssignee(this)">
                        <span class="assignee-avatar">ME</span>
                        <span class="assignee-name">Me</span>
                    </div>
                </td>
                <td>
                    <span class="date-cell" onclick="changeDate(this)">Set Date</span>
                </td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%;">
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="time-est">0h</span>
                </td>
            `;
            
            tbody.insertBefore(newRow, addRow);
            newRow.querySelector('.task-input').focus();
            
            updateSummary();
        }
        
        function addSubitem(parentId) {
            const parentRow = document.querySelector(`.item-row[data-item-id="${parentId}"]`);
            const nextRow = parentRow.nextElementSibling;
            
            const newSubitem = document.createElement('tr');
            newSubitem.className = 'subitem-row';
            newSubitem.dataset.parentId = parentId;
            
            newSubitem.innerHTML = `
                <td></td>
                <td>
                    <div class="task-name">
                        <input type="text" class="task-input" placeholder="Enter subitem..." onblur="updateTask(this)">
                    </div>
                </td>
                <td>
                    <span class="status-pill status-todo" onclick="changeStatus(this)">Not Started</span>
                </td>
                <td>
                    <span class="priority-pill priority-medium" onclick="changePriority(this)">Medium</span>
                </td>
                <td>
                    <div class="assignee-cell" onclick="changeAssignee(this)">
                        <span class="assignee-avatar">ME</span>
                        <span class="assignee-name">Me</span>
                    </div>
                </td>
                <td>
                    <span class="date-cell" onclick="changeDate(this)">Set Date</span>
                </td>
                <td>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%;">
                            <span class="progress-text">0%</span>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="time-est">0h</span>
                </td>
            `;
            
            // Insert after last subitem or after parent
            let insertAfter = parentRow;
            while (nextRow && nextRow.classList.contains('subitem-row') && nextRow.dataset.parentId === parentId) {
                insertAfter = nextRow;
                nextRow = nextRow.nextElementSibling;
            }
            
            insertAfter.parentNode.insertBefore(newSubitem, insertAfter.nextSibling);
            newSubitem.querySelector('.task-input').focus();
        }
        
        function updateSummary() {
            const items = document.querySelectorAll('.item-row').length;
            const statuses = {
                done: document.querySelectorAll('.status-done').length,
                working: document.querySelectorAll('.status-working').length,
                stuck: document.querySelectorAll('.status-stuck').length
            };
            
            const summaryRow = document.querySelector('.summary-row td:last-child');
            if (summaryRow) {
                summaryRow.innerHTML = `
                    <span style="color: #00c875;">${statuses.done} Done</span> •
                    <span style="color: #fdab3d;">${statuses.working} Working</span> •
                    <span style="color: #e2445c;">${statuses.stuck} Stuck</span>
                `;
            }
            
            // Update row numbers
            updateRowNumbers();
        }
        
        // Item ID Management
        let nextItemId = 1004; // Start from 1004 since we have 1001-1003
        
        function generateItemId() {
            return `ITEM-${nextItemId++}`;
        }
        
        function copyItemId(element) {
            const itemId = element.textContent;
            
            // Copy to clipboard
            navigator.clipboard.writeText(itemId).then(() => {
                // Add copied animation
                element.classList.add('copied');
                
                // Show success tooltip
                const tooltip = element.nextElementSibling;
                tooltip.textContent = 'Copied!';
                tooltip.style.background = 'var(--monday-success)';
                
                // Reset after animation
                setTimeout(() => {
                    element.classList.remove('copied');
                    tooltip.textContent = 'Click to copy';
                    tooltip.style.background = '';
                }, 1000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }
        
        function updateItemIds() {
            document.querySelectorAll('.board-table tbody tr.item-row').forEach(row => {
                const idCell = row.querySelector('.item-id-cell');
                if (idCell && !idCell.querySelector('.item-id')) {
                    // Add item ID if it doesn't exist
                    idCell.innerHTML = `
                        <span class="item-id" onclick="copyItemId(this)">${generateItemId()}</span>
                        <span class="item-id-tooltip">Click to copy</span>
                    `;
                }
            });
        }
        
        function filterMondayTasks(filter) {
            const rows = document.querySelectorAll('.item-row, .subitem-row');
            
            if (filter === 'all') {
                rows.forEach(row => row.style.display = 'table-row');
            } else if (filter === 'my') {
                rows.forEach(row => {
                    const assignee = row.querySelector('.assignee-name');
                    if (assignee) {
                        row.style.display = assignee.textContent === 'Me' ? 'table-row' : 'none';
                    }
                });
            }
        }
        
        function groupBy(criteria) {
            // In production, reorganize table rows by criteria
            console.log(`Grouping by ${criteria}`);
            alert(`Grouping by ${criteria} - Feature coming soon!`);
        }
        
        // Column Management Functions
        function showAddColumnMenu(element) {
            const menu = document.createElement('div');
            menu.className = 'column-type-menu active';
            menu.style.right = '0';
            menu.style.left = 'auto';
            
            menu.innerHTML = `
                <div class="column-type-header">Add Column</div>
                ${Object.entries(availableColumns).map(([type, info]) => `
                    <div class="column-type-item" onclick="addColumn('${type}')">
                        <div class="column-type-icon">${info.icon}</div>
                        <div class="column-type-info">
                            <div class="column-type-name">${info.name}</div>
                            <div class="column-type-desc">${info.desc}</div>
                        </div>
                    </div>
                `).join('')}
            `;
            
            element.appendChild(menu);
            
            // Close on click outside
            setTimeout(() => {
                document.addEventListener('click', function closeMenu(e) {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                });
            }, 100);
        }
        
        function addColumn(type) {
            const table = document.querySelector('.board-table');
            const headerRow = table.querySelector('thead tr');
            const addBtn = headerRow.querySelector('.add-column-btn');
            
            const newHeader = document.createElement('th');
            newHeader.style.width = '150px';
            newHeader.innerHTML = `
                <div class="column-header" onclick="showColumnTypeMenu(this, '${type}')">
                    <div class="column-header-content">
                        <span class="column-icon">${availableColumns[type].icon}</span>
                        <span class="column-name">${availableColumns[type].name}</span>
                    </div>
                    <div class="column-actions">
                        <button class="column-action-btn" onclick="editColumn(event, '${type}')">✏️</button>
                        <button class="column-action-btn" onclick="deleteColumn(event, '${type}')">×</button>
                    </div>
                </div>
                <div class="column-resize-handle" onmousedown="startResize(event, this)"></div>
            `;
            
            headerRow.insertBefore(newHeader, addBtn);
            
            // Add cells to all rows
            document.querySelectorAll('.board-table tbody tr').forEach(row => {
                const newCell = document.createElement('td');
                newCell.innerHTML = `<div class="cell-content">${getDefaultCellContent(type)}</div>`;
                const lastCell = row.lastElementChild;
                row.insertBefore(newCell, lastCell);
            });
            
            // Close menu
            document.querySelector('.column-type-menu').remove();
        }
        
        function getDefaultCellContent(type) {
            switch(type) {
                case 'status':
                    return '<span class="status-pill status-todo" onclick="changeStatus(this)">Not Started</span>';
                case 'person':
                    return `<div class="assignee-cell" onclick="changeAssignee(this)">
                        <span class="assignee-avatar">--</span>
                        <span class="assignee-name">Unassigned</span>
                    </div>`;
                case 'date':
                    return '<span class="date-cell" onclick="changeDate(this)">Set Date</span>';
                case 'checkbox':
                    return '<input type="checkbox" style="width: 16px; height: 16px;">';
                case 'progress':
                    return `<div class="progress-bar">
                        <div class="progress-fill" style="width: 0%;">
                            <span class="progress-text">0%</span>
                        </div>
                    </div>`;
                case 'rating':
                    return '⭐⭐⭐☆☆';
                case 'number':
                    return '<input type="number" class="task-input" value="0" style="width: 80px;">';
                default:
                    return '<input type="text" class="task-input" placeholder="Enter...">';
            }
        }
        
        function editColumn(event, columnType) {
            event.stopPropagation();
            const header = event.target.closest('.column-header');
            const nameElement = header.querySelector('.column-name');
            const currentName = nameElement.textContent;
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = currentName;
            input.className = 'task-input';
            input.style.fontSize = '13px';
            input.style.fontWeight = '500';
            
            nameElement.replaceWith(input);
            input.focus();
            input.select();
            
            input.onblur = input.onkeydown = function(e) {
                if (e.type === 'blur' || e.key === 'Enter') {
                    const newName = document.createElement('span');
                    newName.className = 'column-name';
                    newName.textContent = input.value || currentName;
                    input.replaceWith(newName);
                }
            };
        }
        
        function deleteColumn(event, columnType) {
            event.stopPropagation();
            if (confirm('Delete this column?')) {
                const header = event.target.closest('th');
                const index = Array.from(header.parentNode.children).indexOf(header);
                
                // Remove header
                header.remove();
                
                // Remove cells from all rows
                document.querySelectorAll('.board-table tbody tr').forEach(row => {
                    if (row.children[index]) {
                        row.children[index].remove();
                    }
                });
            }
        }
        
        function selectRow(checkbox) {
            const row = checkbox.closest('tr');
            if (checkbox.checked) {
                row.classList.add('selected');
                selectedRows.add(row.dataset.itemId);
            } else {
                row.classList.remove('selected');
                selectedRows.delete(row.dataset.itemId);
            }
            updateBatchActionBar();
        }
        
        function updateBatchActionBar() {
            const bar = document.getElementById('batchActionBar');
            const count = document.getElementById('selectedCount');
            
            if (selectedRows.size > 0) {
                bar.classList.add('active');
                count.textContent = selectedRows.size;
            } else {
                bar.classList.remove('active');
            }
        }
        
        function clearSelection() {
            document.querySelectorAll('.board-table tbody .row-checkbox').forEach(cb => {
                cb.checked = false;
                selectRow(cb);
            });
            document.querySelector('.board-table thead .row-checkbox').checked = false;
        }
        
        function batchChangeStatus() {
            alert(`Changing status for ${selectedRows.size} items`);
        }
        
        function batchAssign() {
            alert(`Assigning ${selectedRows.size} items`);
        }
        
        function batchDuplicate() {
            alert(`Duplicating ${selectedRows.size} items`);
        }
        
        function batchDelete() {
            if (confirm(`Delete ${selectedRows.size} items?`)) {
                selectedRows.forEach(id => {
                    const row = document.querySelector(`tr[data-item-id="${id}"]`);
                    if (row) row.remove();
                });
                clearSelection();
            }
        }
        
        function selectAllRows(checkbox) {
            document.querySelectorAll('.board-table tbody .row-checkbox').forEach(cb => {
                cb.checked = checkbox.checked;
                selectRow(cb);
            });
        }
        
        function searchTasks(query) {
            const rows = document.querySelectorAll('.item-row, .subitem-row');
            const lowerQuery = query.toLowerCase();
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(lowerQuery) ? 'table-row' : 'none';
            });
        }
        
        function switchView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (view === 'cards' || view === 'timeline') {
                alert(`${view.charAt(0).toUpperCase() + view.slice(1)} view coming soon!`);
            }
        }
        
        function sortColumn(columnName) {
            // Implementation for column sorting
            console.log(`Sorting by ${columnName}`);
        }
        
        // Column Resizing Functions
        let isResizing = false;
        let currentColumn = null;
        let startX = 0;
        let startWidth = 0;
        let resizeLine = null;
        
        function startResize(event, handle) {
            event.preventDefault();
            event.stopPropagation();
            
            isResizing = true;
            currentColumn = handle.parentElement;
            startX = event.pageX;
            startWidth = currentColumn.offsetWidth;
            
            handle.classList.add('resizing');
            
            // Show resize line
            resizeLine = document.getElementById('resizeLine');
            const tableWrapper = document.getElementById('tableWrapper');
            const rect = handle.getBoundingClientRect();
            const wrapperRect = tableWrapper.getBoundingClientRect();
            
            resizeLine.style.left = (rect.right - wrapperRect.left) + 'px';
            resizeLine.classList.add('active');
            
            document.addEventListener('mousemove', handleResize);
            document.addEventListener('mouseup', stopResize);
            
            // Prevent text selection while resizing
            document.body.style.userSelect = 'none';
            document.body.style.cursor = 'col-resize';
        }
        
        function handleResize(event) {
            if (!isResizing) return;
            
            const diff = event.pageX - startX;
            // Different minimum widths for different column types
            let minWidth = 50;
            if (currentColumn.classList.contains('checkbox-cell')) {
                minWidth = 30;
            } else if (currentColumn.classList.contains('item-id-cell')) {
                minWidth = 80;
            }
            const newWidth = Math.max(minWidth, startWidth + diff);
            
            // Update resize line position
            const tableWrapper = document.getElementById('tableWrapper');
            const wrapperRect = tableWrapper.getBoundingClientRect();
            resizeLine.style.left = (event.pageX - wrapperRect.left) + 'px';
        }
        
        function stopResize(event) {
            if (!isResizing) return;
            
            const diff = event.pageX - startX;
            // Different minimum widths for different column types
            let minWidth = 50;
            if (currentColumn.classList.contains('checkbox-cell')) {
                minWidth = 30;
            } else if (currentColumn.classList.contains('item-id-cell')) {
                minWidth = 80;
            }
            const newWidth = Math.max(minWidth, startWidth + diff);
            
            // Apply the new width
            currentColumn.style.width = newWidth + 'px';
            
            // Update all cells in this column
            const columnIndex = Array.from(currentColumn.parentNode.children).indexOf(currentColumn);
            document.querySelectorAll('.board-table tbody tr').forEach(row => {
                if (row.children[columnIndex]) {
                    row.children[columnIndex].style.width = newWidth + 'px';
                }
            });
            
            // Clean up
            isResizing = false;
            currentColumn = null;
            
            document.removeEventListener('mousemove', handleResize);
            document.removeEventListener('mouseup', stopResize);
            
            // Hide resize line
            resizeLine.classList.remove('active');
            
            // Remove resizing class from handle
            document.querySelectorAll('.column-resize-handle').forEach(handle => {
                handle.classList.remove('resizing');
            });
            
            // Restore cursor
            document.body.style.userSelect = '';
            document.body.style.cursor = '';
            
            // Save column widths to localStorage
            saveColumnWidths();
        }
        
        function saveColumnWidths() {
            const widths = {};
            document.querySelectorAll('.board-table thead th').forEach((th, index) => {
                const columnName = th.querySelector('.column-name');
                if (columnName) {
                    widths[columnName.textContent] = th.style.width;
                }
            });
            localStorage.setItem('mondayColumnWidths', JSON.stringify(widths));
        }
        
        function loadColumnWidths() {
            const widths = JSON.parse(localStorage.getItem('mondayColumnWidths') || '{}');
            document.querySelectorAll('.board-table thead th').forEach(th => {
                const columnName = th.querySelector('.column-name');
                if (columnName && widths[columnName.textContent]) {
                    th.style.width = widths[columnName.textContent];
                }
            });
        }
        
        // Check for existing session
        const token = localStorage.getItem('token');
        if (token) {
            // In production, validate token with backend
            loginDemo();
        }
    </script>
</body>
</html>